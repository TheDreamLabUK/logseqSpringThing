# WebXR Graph Visualization of Logseq Knowledge Graphs with RAGFlow Integration

![image](https://github.com/user-attachments/assets/269a678d-88a5-42de-9d67-d73b64f4e520)

Inspired by Prof Rob Aspin's work:  
https://github.com/trebornipsa

![P1080785_1728030359430_0](https://github.com/user-attachments/assets/3ecac4a3-95d7-4c75-a3b2-e93deee565d6)

## Project Overview

This project visualizes a Logseq knowledge graph in 3D using WebXR, enhancing it with Perplexity AI and RAGFlow for AI-powered question answering. Changes are automatically submitted back to the source GitHub repository as pull requests. This allows for a dynamic and interactive exploration of your Logseq knowledge base in an immersive environment, leveraging the power of AI to provide context and insights.

## Key Features

- **WebXR 3D Visualization:** Immersive exploration of the knowledge graph in AR/VR environments with support for:
  - **Node Interaction and Manipulation:** Click, drag, and reposition nodes within the 3D space.
  - **Dynamic Force-Directed Layout:** Real-time recalculation of graph layout based on interactions and data updates.
  - **Custom Shaders for Visual Effects:** Enhancements like holographic displays and lighting effects.
  - **Fisheye Distortion for Focus + Context Visualization:** Provides a focus on specific areas while maintaining context.

- **Real-time Updates:**
  - **WebSocket-Based Communication:** Ensures instant synchronization between the server and client.
  - **Optimized Binary Protocol:** 
    - Efficient quantized position updates (millimeter precision)
    - Quantized velocity updates (0.0001 unit precision)
    - Compact 28-byte format per node (4-byte header + 24 bytes position/velocity)
  - **Automatic Graph Layout Recalculation:** Maintains an optimal layout as the graph evolves.
  - **Live Preview of Changes:** Immediate reflection of updates from the knowledge base.

- **GPU Acceleration:**
  - **WebGPU Compute Shaders for Layout Calculation:** Utilizes GPU for high-performance graph computations.
  - **Efficient Force-Directed Algorithms:** Enhances the responsiveness of the graph layout.
  - **Fallback to CPU Computation:** Ensures compatibility with devices lacking WebGPU support.
  - **Custom WGSL Shaders for Visual Effects:** Enables advanced rendering techniques.

- **RAGFlow Integration:**
  - **Context-Aware Question Answering:** Provides intelligent responses based on the knowledge graph.
  - **Dynamic Document Retrieval:** Fetches relevant documents to support AI responses.
  - **Conversation History Management:** Maintains context for ongoing interactions.
  - **Real-Time Response Streaming:** Delivers responses as they are generated by the AI.

- **Perplexity AI Enhancement:**
  - **Markdown Content Analysis:** Parses and understands the structure of markdown files.
  - **Topic Extraction and Linking:** Identifies and connects related topics within the knowledge base.
  - **Automatic Summarization:** Generates concise summaries for long-form content.
  - **Content Relationship Mapping:** Visualizes how different pieces of content interrelate.

- **Spacemouse Support:**
  - **6-DOF Navigation in VR:** Allows for intuitive movement within the 3D environment.
  - **Customizable Control Mapping:** Adapts to various input devices.
  - **Smooth Camera Transitions:** Ensures fluid user experience during navigation.
  - **Integration with WebXR Controls:** Combines hardware input with web-based controls for enhanced interaction.

- **Automatic GitHub PRs:**
  - **Automated Branch Creation:** Manages branches for updates seamlessly.
  - **File Content Updates:** Applies changes directly to relevant files.
  - **Pull Request Generation:** Facilitates the review and merging process.
  - **Metadata Synchronization:** Keeps metadata in sync with file updates.

- **Audio Features:**
  - **OpenAI Text-to-Speech:** Converts text responses into audible speech.
  - **Local Speech Synthesis Fallback:** Ensures functionality without external dependencies.
  - **WebSocket Streaming:** Delivers audio streams efficiently.
  - **Dynamic Provider Switching:** Allows for flexible configuration of audio sources.

## Technical Architecture

### Binary Protocol Format

The WebSocket binary protocol has been optimized for efficient position updates:

```
[4 bytes] is_initial_layout flag (float32)
For each node:
  [12 bytes] Position (3 × int32, quantized to millimeter precision)
  [12 bytes] Velocity (3 × int32, quantized to 0.0001 units)
```

This format provides:
- Minimal bandwidth usage through quantization
- High precision where needed (millimeter-level positioning)
- Efficient parsing on both client and server
- Clear distinction between initial and update messages

[Previous architecture diagrams and sections remain unchanged...]

### Performance Optimizations

- **Network Efficiency:**
  - Quantized position and velocity values
  - Compact binary message format
  - Minimal protocol overhead
  - Efficient WebSocket streaming

- **Rendering Performance:**
  - GPU-accelerated computations
  - Optimized Three.js rendering
  - Efficient state management
  - Minimal UI overhead

### Core System Architecture

```mermaid
graph TB
    subgraph Frontend
        UI[User Interface Layer]
        VR[WebXR Controller]
        WS[WebSocket Client]
        GPU[GPU Compute Layer]
        ThreeJS[Three.js Renderer]
        ChatUI[Chat Interface]
        GraphUI[Graph Interface]
        ControlPanel[Control Panel]
        VRControls[VR Control System]
        WSService[WebSocket Service]
        DataManager[Graph Data Manager]
        LayoutEngine[Layout Engine]
        SpaceMouse[SpaceMouse Controller]
    end

    subgraph Backend
        Server[Actix Web Server]
        FileH[File Handler]
        GraphH[Graph Handler]
        WSH[WebSocket Handler]
        PerplexityH[Perplexity Handler]
        RagFlowH[RagFlow Handler]
        VisualizationH[Visualization Handler]
        FileS[File Service]
        GraphS[Graph Service]
        GPUS[GPU Compute Service]
        PerplexityS[Perplexity Service]
        RagFlowS[RagFlow Service]
        SpeechS[Speech Service]
        WSManager[WebSocket Manager]
        GPUCompute[GPU Compute]
        Compression[Compression Utils]
        AudioProc[Audio Processor]
        Node[Node Model]
        Edge[Edge Model]
        Graph[Graph Model]
        Metadata[Metadata Model]
        Position[Position Update Model]
        SimParams[Simulation Parameters]
    end

    subgraph External
        GitHub[GitHub API]
        Perplexity[Perplexity AI]
        RagFlow[RagFlow API]
        OpenAI[OpenAI API]
    end

    UI --> ChatUI
    UI --> GraphUI
    UI --> ControlPanel
    UI --> VRControls

    VR --> ThreeJS
    WS --> WSService
    WSService --> Server

    Server --> FileH
    Server --> GraphH
    Server --> WSH
    Server --> PerplexityH
    Server --> RagFlowH
    Server --> VisualizationH

    FileH --> FileS
    GraphH --> GraphS
    WSH --> WSManager
    PerplexityH --> PerplexityS
    RagFlowH --> RagFlowS

    FileS --> GitHub
    PerplexityS --> Perplexity
    RagFlowS --> RagFlow
    SpeechS --> OpenAI

    style Frontend fill:#f9f,stroke:#333,stroke-width:2px
    style Backend fill:#bbf,stroke:#333,stroke-width:2px
    style External fill:#bfb,stroke:#333,stroke-width:2px
```

### Class Diagram

```mermaid
classDiagram
    class App {
        -platformManager: PlatformManager
        -settingsManager: SettingsManager
        -graphDataManager: GraphDataManager
        -webSocketService: WebSocketService
        -sceneManager: SceneManager
        -nodeManager: NodeManager
        -textRenderer: TextRenderer
        -xrSessionManager: XRSessionManager
        -xrInteraction: XRInteraction
        -controlPanel: ControlPanel
        +start()
        +initializeEventListeners()
        +toggleFullscreen()
    }

    class PlatformManager {
        +getPlatform(): Platform
        +isMobile(): boolean
        +isDesktop(): boolean
        +isQuest(): boolean
        +supportsXR(): boolean
        +supportsWebXR(): boolean
        +supportsWebGPU(): boolean
        +getWebXRFeatures(): string[]
    }

    class SettingsManager {
        -settings: Settings
        -defaultSettings: Settings
        -subscribers: Map<string, Function[]>
        +getCurrentSettings(): Settings
        +getDefaultSettings(): Settings
        +updateSetting(category: string, setting: string, value: any)
        +subscribe(category: string, setting: string, callback: Function)
        +dispose()
    }

    class GraphDataManager {
        -nodes: Map<string, Node>
        -edges: Map<string, Edge>
        -listeners: Function[]
        +updateGraphData(data: GraphData)
        +updateNodePositions(positions: Float32Array)
        +fetchGraphData(page: number, pageSize: number)
        +fetchMoreNodes()
        +enableBinaryUpdates()
        +disableBinaryUpdates()
        +dispose()
    }

    class WebSocketService {
        -socket: WebSocket
        -url: string
        -messageQueue: ArrayBuffer[] | string[]
        -isConnected: boolean
        -isReconnecting: boolean
        -reconnectAttempts: number
        -maxReconnectAttempts: number
        -reconnectInterval: number
        -heartbeatIntervalId: number
        +connect()
        +send(data: ArrayBuffer | string)
        -handleOpen()
        -handleMessage(event: MessageEvent)
        -handleClose(event: CloseEvent)
        -handleError(event: Event)
        -sendHeartbeat()
        -enqueueMessage(message: ArrayBuffer | string)
        -flushQueue()
        -reconnect()
        +dispose()
    }

    class SceneManager {
        -scene: THREE.Scene
        -camera: THREE.PerspectiveCamera
        -renderer: THREE.WebGLRenderer
        -controls: OrbitControls
        -composer: EffectComposer
        -bloomPass: UnrealBloomPass
        -animationId: number
        +start()
        +stop()
        +render()
        +add(object: THREE.Object3D)
        +remove(object: THREE.Object3D)
        +dispose()
    }

    class NodeManager {
        -nodeGeometry: THREE.SphereGeometry
        -nodeMaterial: THREE.MeshBasicMaterial
        -edgeGeometry: THREE.CylinderGeometry
        -edgeMaterial: THREE.MeshBasicMaterial
        -nodes: Map<string, NodeInstance>
        -edges: Map<string, EdgeInstance>
        +updateNodes(nodes: Node[])
        +updateEdges(edges: Edge[])
        +updateNodePositions(positions: Float32Array)
        +dispose()
    }

    class NodeInstance {
        -id: string
        -mesh: THREE.Mesh
        -color: THREE.Color
        -position: THREE.Vector3
        +setColor(color: THREE.Color)
        +setPosition(position: THREE.Vector3)
    }

    class EdgeInstance {
        -id: string
        -line: THREE.Line
        -startNode: NodeInstance
        -endNode: NodeInstance
        +updatePosition()
    }

    class TextRenderer {
        -labels: Map<string, HTMLDivElement>
        +addLabel(id: string, text: string, position: THREE.Vector3)
        +removeLabel(id: string)
        +update()
        +dispose()
    }

    class XRSessionManager {
        -renderer: THREE.WebGLRenderer
        -session: XRSession
        -referenceSpace: XRReferenceSpace
        -inputSources: XRInputSource[]
        +initialize(renderer: THREE.WebGLRenderer)
        +startSession(sessionType: XRSessionType)
        +endSession()
        +requestReferenceSpace(referenceSpaceType: XRReferenceSpaceType)
        +onSessionStarted(session: XRSession)
        +onSessionEnded()
        +onInputsChanged(event: XRInputSourceChangeEvent)
        +onSelectStart(event: XRInputSourceEvent)
        +onSelectEnd(event: XRInputSourceEvent)
        +onSqueezeStart(event: XRInputSourceEvent)
        +onSqueezeEnd(event: XRInputSourceEvent)
        +update()
    }

    class XRInteraction {
        -raycaster: THREE.Raycaster
        -tempMatrix: THREE.Matrix4
        -controller1: THREE.Group
        -controller2: THREE.Group
        -controllerGrip1: THREE.Group
        -controllerGrip2: THREE.Group
        -intersected: THREE.Object3D[]
        +initialize(renderer: THREE.WebGLRenderer, scene: THREE.Scene, xrSessionManager: XRSessionManager)
        +createController(controllerIndex: number)
        +handleController(controller: THREE.Group)
        +intersectObjects(controller: THREE.Group)
        +cleanIntersected()
        +dispose()
    }

    class ControlPanel {
        -settingsManager: SettingsManager
        +initialize()
        +createControls()
        +addSettingControl(category: string, setting: string, value: any)
        +updateSetting(category: string, setting: string, value: any)
        +saveSettings()
        +resetSettings()
    }

    class AppState {
        +graph_service: GraphService
        +gpu_compute: Option<GPUCompute>
        +settings: Arc<RwLock<Settings>>
        +metadata_store: Arc<RwLock<MetadataStore>>
        +github_service: RealGitHubService
        +perplexity_service: Option<PerplexityService>
        +rag_flow_service: Option<RAGFlowService>
        +github_pr_service: RealGitHubPRService
        +active_connections: AtomicUsize
        +increment_connection_count()
        +decrement_connection_count()
    }

    class GraphService {
        +build_graph_from_metadata(metadata_store: &MetadataStore): Result<GraphData, Error>
        +get_graph_data(): Result<GraphData, Error>
        +get_paginated_graph_data(pagination: PaginationParams): Result<PaginatedGraphData, Error>
        +get_node_positions(): Result<Vec<PositionUpdate>, Error>
    }

    class GPUCompute {
        +device: wgpu::Device
        +queue: wgpu::Queue
        +compute_pipeline: wgpu::ComputePipeline
        +position_buffer: wgpu::Buffer
        +velocity_buffer: wgpu::Buffer
        +force_buffer: wgpu::Buffer
        +node_buffer: wgpu::Buffer
        +edge_buffer: wgpu::Buffer
        +params_buffer: wgpu::Buffer
        +bind_group: wgpu::BindGroup
        +set_graph_data(graph_data: &GraphData, simulation_params: &GPUSimulationParams): Result<(), Error>
        +compute_forces(): Result<(), Error>
        +get_updated_positions(): Result<Vec<PositionUpdate>, Error>
    }

    class Settings {
        +github: GitHubSettings
        +graph: GraphSettings
        +visualization: VisualizationSettings
        +perplexity: PerplexitySettings
        +rag_flow: RAGFlowSettings
        +audio: AudioSettings
    }

    class MetadataStore {
        +metadata: HashMap<String, Metadata>
        +add_metadata(metadata: Metadata)
        +get_metadata(file_name: &str): Option<&Metadata>
        +update_metadata(file_name: &str, metadata: Metadata)
        +remove_metadata(file_name: &str)
    }

    class RealGitHubService {
        +client: reqwest::Client
        +headers: HeaderMap
        +fetch_files(settings: &GitHubSettings): Result<Vec<GitHubFile>, Error>
        +fetch_file_content(settings: &GitHubSettings, file: &GitHubFile): Result<String, Error>
    }

    class PerplexityService {
        +client: reqwest::Client
        +send_request(settings: &PerplexitySettings, request: &PerplexityRequest): Result<PerplexityResponse, Error>
    }

    class RAGFlowService {
        +client: reqwest::Client
        +init_chat(settings: &RAGFlowSettings): Result<String, Error>
        +send_message(settings: &RAGFlowSettings, chat_id: &str, message: &str): Result<String, Error>
        +get_chat_history(settings: &RAGFlowSettings, chat_id: &str): Result<Vec<RAGFlowMessage>, Error>
    }

    class RealGitHubPRService {
        +client: reqwest::Client
        +headers: HeaderMap
        +create_or_update_file(settings: &GitHubSettings, file_name: &str, content: &str, sha: Option<&str>): Result<String, Error>
        +create_pull_request(settings: &GitHubSettings, title: &str, body: &str, head_branch: &str, base_branch: &str): Result<String, Error>
    }

    class FileService {
        +fetch_and_process_files(github_service: &RealGitHubService, settings: Arc<RwLock<Settings>>, metadata_store: &mut MetadataStore): Result<(), Error>
        +load_or_create_metadata(settings: &Settings): Result<MetadataStore, Error>
        +get_file_content(file_name: &str): Result<String, Error>
        +refresh_graph(github_service: &RealGitHubService, settings: Arc<RwLock<Settings>>, metadata_store: &mut MetadataStore, graph_service: &GraphService): Result<(), Error>
        +update_graph(github_service: &RealGitHubService, settings: Arc<RwLock<Settings>>, metadata_store: &mut MetadataStore, graph_service: &GraphService): Result<(), Error>
        +save_metadata(metadata: &MetadataStore, settings: &Settings): Result<(), Error>
    }

    class SocketFlowServer {
        -app_state: AppState
        +new(app_state: AppState)
        +handle_ping(ctx: &mut ws::WebsocketContext<Self>, message: &str)
        +send_position_updates(ctx: &mut ws::WebsocketContext<Self>)
        +actor_started(ctx: &mut ws::WebsocketContext<Self>)
        +actor_stopped(ctx: &mut ws::WebsocketContext<Self>)
        +handle_message(ctx: &mut ws::WebsocketContext<Self>, msg: Result<ws::Message, ws::ProtocolError>)
    }

    App --> PlatformManager
    App --> SettingsManager
    App --> GraphDataManager
    App --> WebSocketService
    App --> SceneManager
    App --> NodeManager
    App --> TextRenderer
    App --> "0..1" XRSessionManager
    App --> "0..1" XRInteraction
    App --> ControlPanel
    SettingsManager --> Settings
    GraphDataManager --> Node
    GraphDataManager --> Edge
    WebSocketService --> GraphDataManager
    SceneManager --> NodeManager
    SceneManager --> TextRenderer
    NodeManager --> NodeInstance
    NodeManager --> EdgeInstance
    EdgeInstance --> NodeInstance
    XRSessionManager --> XRInteraction
    ControlPanel --> SettingsManager
    AppState --> GraphService
    AppState --> "0..1" GPUCompute
    AppState --> Settings
    AppState --> MetadataStore
    AppState --> RealGitHubService
    AppState --> "0..1" PerplexityService
    AppState --> "0..1" RAGFlowService
    AppState --> RealGitHubPRService
    GraphService --> GraphData
    GraphService --> Node
    GraphService --> Edge
    GPUCompute --> GraphData
    GPUCompute --> GPUSimulationParams
    MetadataStore --> Metadata
    RealGitHubService --> GitHubFile
    PerplexityService --> PerplexityRequest
    PerplexityService --> PerplexityResponse
    RAGFlowService --> RAGFlowMessage
    FileService --> MetadataStore
    FileService --> GraphService
    SocketFlowServer --> AppState
```

### Sequence Diagram

```mermaid
sequenceDiagram
    participant Client
    participant App
    participant PlatformManager
    participant SettingsManager
    participant GraphDataManager
    participant WebSocketService
    participant SceneManager
    participant NodeManager
    participant TextRenderer
    participant ControlPanel
    participant Server
    participant FileService
    participant GraphService
    participant GPUCompute
    participant MetadataStore
    participant GitHubService
    participant PerplexityService
    participant RAGFlowService
    participant GitHubPRService
    participant SocketFlowServer

    Client->>App: start()
    activate App
    App->>PlatformManager: getPlatform()
    activate PlatformManager
    PlatformManager-->>App: Platform
    deactivate PlatformManager
    App->>SettingsManager: new()
    activate SettingsManager
    SettingsManager->>Server: GET /api/visualization/settings
    activate Server
    Server->>SettingsManager: load_all_settings()
    activate SettingsManager
    SettingsManager-->>Server: Settings
    deactivate SettingsManager
    Server-->>SettingsManager: Settings
    deactivate Server
    SettingsManager-->>App: SettingsManager
    deactivate SettingsManager
    App->>GraphDataManager: new()
    activate GraphDataManager
    GraphDataManager-->>App: GraphDataManager
    deactivate GraphDataManager
    App->>WebSocketService: new(url)
    activate WebSocketService
    WebSocketService->>WebSocketService: connect()
    WebSocketService->>Server: Establish WebSocket Connection
    activate Server
    Server->>SocketFlowServer: new(AppState)
    activate SocketFlowServer
    SocketFlowServer-->>Server: SocketFlowServer
    deactivate SocketFlowServer
    Server-->>WebSocketService: WebSocket Connection Established
    deactivate Server
    WebSocketService-->>App: WebSocketService
    deactivate WebSocketService
    App->>SceneManager: new(canvas)
    activate SceneManager
    SceneManager-->>App: SceneManager
    deactivate SceneManager
    App->>NodeManager: new()
    activate NodeManager
    NodeManager-->>App: NodeManager
    deactivate NodeManager
    App->>TextRenderer: new()
    activate TextRenderer
    TextRenderer-->>App: TextRenderer
    deactivate TextRenderer
    App->>ControlPanel: new(SettingsManager)
    activate ControlPanel
    ControlPanel-->>App: ControlPanel
    deactivate ControlPanel
    App->>SceneManager: start()
    activate SceneManager
    SceneManager->>SceneManager: render()
    deactivate SceneManager
    App->>WebSocketService: send(initial graph request)
    activate WebSocketService
    WebSocketService->>Server: initial graph request
    deactivate WebSocketService
    activate Server
    Server->>GraphService: get_graph_data()
    activate GraphService
    GraphService->>MetadataStore: get_metadata()
    activate MetadataStore
    MetadataStore-->>GraphService: Metadata
    deactivate MetadataStore
    alt GPUCompute available
        GraphService->>GPUCompute: set_graph_data()
        activate GPUCompute
        GPUCompute-->>GraphService: Result
        deactivate GPUCompute
        GraphService->>GPUCompute: compute_forces()
        activate GPUCompute
        GPUCompute-->>GraphService: Result
        deactivate GPUCompute
        GraphService->>GPUCompute: get_updated_positions()
        activate GPUCompute
        GPUCompute-->>GraphService: Vec<PositionUpdate>
        deactivate GPUCompute
    else CPU computation
        GraphService->>GraphService: compute_forces_cpu()
    end
    GraphService-->>Server: GraphData
    deactivate GraphService
    Server->>WebSocketService: send(GraphData)
    activate WebSocketService
    WebSocketService->>GraphDataManager: updateGraphData(GraphData)
    deactivate WebSocketService
    activate GraphDataManager
    GraphDataManager->>NodeManager: updateNodes(nodes)
    activate NodeManager
    NodeManager-->>GraphDataManager: Result
    deactivate NodeManager
    GraphDataManager->>NodeManager: updateEdges(edges)
    activate NodeManager
    NodeManager-->>GraphDataManager: Result
    deactivate NodeManager
    GraphDataManager-->>App: Result
    deactivate GraphDataManager
    
    loop User Interaction
        Client->>ControlPanel: updateSetting(category, setting, value)
        activate ControlPanel
        ControlPanel->>SettingsManager: updateSetting(category, setting, value)
        activate SettingsManager
        SettingsManager->>Server: POST /api/visualization/settings/{category}/{setting}
        activate Server
        Server->>SettingsManager: update_setting(category, setting, value)
        activate SettingsManager
        SettingsManager-->>Server: Result
        deactivate SettingsManager
        Server-->>SettingsManager: Result
        deactivate Server
        SettingsManager-->>ControlPanel: Result
        deactivate SettingsManager
        ControlPanel-->>Client: Setting Updated
        deactivate ControlPanel
    end

    loop User Interaction
        Client->>Server: POST /api/files/fetch
        activate Server
        Server->>FileService: fetch_and_process_files()
        activate FileService
        FileService->>GitHubService: fetch_files()
        activate GitHubService
        GitHubService-->>FileService: Vec<GitHubFile>
        deactivate GitHubService
        FileService->>FileService: process_files()
        loop for each file
            FileService->>PerplexityService: send_request()
            activate PerplexityService
            PerplexityService-->>FileService: PerplexityResponse
            deactivate PerplexityService
        end
        FileService->>MetadataStore: add_metadata()
        activate MetadataStore
        MetadataStore-->>FileService: Result
        deactivate MetadataStore
        FileService-->>Server: Result
        deactivate FileService
        Server->>GraphService: build_graph_from_metadata()
        activate GraphService
        alt GPUCompute available
            GraphService->>GPUCompute: set_graph_data()
            activate GPUCompute
            GPUCompute-->>GraphService: Result
            deactivate GPUCompute
            GraphService->>GPUCompute: compute_forces()
            activate GPUCompute
            GPUCompute-->>GraphService: Result
            deactivate GPUCompute
            GraphService->>GPUCompute: get_updated_positions()
            activate GPUCompute
            GPUCompute-->>GraphService: Vec<PositionUpdate>
            deactivate GPUCompute
        else CPU computation
            GraphService->>GraphService: compute_forces_cpu()
        end
        GraphService-->>Server: GraphData
        deactivate GraphService
        Server->>WebSocketService: send(GraphData)
        activate WebSocketService
        WebSocketService->>GraphDataManager: updateGraphData(GraphData)
        deactivate WebSocketService
        activate GraphDataManager
        GraphDataManager->>NodeManager: updateNodes(nodes)
        activate NodeManager
        NodeManager-->>GraphDataManager: Result
        deactivate NodeManager
        GraphDataManager->>NodeManager: updateEdges(edges)
        activate NodeManager
        NodeManager-->>GraphDataManager: Result
        deactivate NodeManager
        GraphDataManager-->>App: Result
        deactivate GraphDataManager
        Server-->>Client: Files Fetched and Processed
        deactivate Server
    end

    loop User Interaction
        Client->>Server: POST /api/ragflow/init
        activate Server
        Server->>RAGFlowService: init_chat()
        activate RAGFlowService
        RAGFlowService-->>Server: chat_id
        deactivate RAGFlowService
        Server-->>Client: chat_id
        deactivate Server

        Client->>Server: POST /api/ragflow/message
        activate Server
        Server->>RAGFlowService: send_message()
        activate RAGFlowService
        RAGFlowService-->>Server: response
        deactivate RAGFlowService
        Server-->>Client: response
        deactivate Server
    end
```

### WebGPU Compute Pipeline

```mermaid
graph TB
    subgraph inputBuffers ["Input Buffers"]
        NodesData[Node Data Buffer]
        EdgesData[Edge Data Buffer]
        ForcesData[Force Buffer]
        ParamsData[Simulation Parameters Buffer]
    end

    subgraph computePipeline ["Compute Pipeline"]
        BindGroupLayout[Bind Group Layout]

        subgraph shaders ["Shaders"]
            ForceCalculation[Force Calculation Shader]
            PositionUpdate[Position Update Shader]
            FisheyeEffect[Fish-Eye Distortion Shader]
        end

        DispatchBlock[Dispatch Workgroups]
    end

    subgraph outputBuffers ["Output Buffers"]
        NewPositions[Updated Position Buffer]
        VisualizationData[Visualization Data Buffer]
    end

    NodesData --> BindGroupLayout
    EdgesData --> BindGroupLayout
    ForcesData --> BindGroupLayout
    ParamsData --> BindGroupLayout

    BindGroupLayout --> ForceCalculation
    ForceCalculation --> PositionUpdate
    PositionUpdate --> FisheyeEffect

    DispatchBlock -->|Workgroup 1| ForceCalculation
    DispatchBlock -->|Workgroup 2| PositionUpdate
    DispatchBlock -->|Workgroup 3| FisheyeEffect

    FisheyeEffect --> NewPositions
    FisheyeEffect --> VisualizationData

    %% Define styles for classes
    classDef inputBufferStyle fill:#f9f,stroke:#333,stroke-width:2px
    classDef computePipelineStyle fill:#bbf,stroke:#333,stroke-width:2px
    classDef outputBufferStyle fill:#bfb,stroke:#333,stroke-width:2px

    %% Assign classes to nodes within subgraphs
    class NodesData,EdgesData,ForcesData,ParamsData inputBufferStyle
    class BindGroupLayout,DispatchBlock computePipelineStyle
    class ForceCalculation,PositionUpdate,FisheyeEffect computePipelineStyle
    class NewPositions,VisualizationData outputBufferStyle
```



## Contributing

Contributions are welcome! Please follow the guidelines below to contribute effectively.

### How to Contribute

1. **Fork the Repository:**
    Click the "Fork" button at the top-right corner of the repository page.

2. **Clone Your Fork:**
    ```bash
    git clone https://github.com/yourusername/webxr-graph.git
    cd webxr-graph
    ```

3. **Create a Feature Branch:**
    ```bash
    git checkout -b feature/YourFeatureName
    ```

4. **Commit Your Changes:**
    ```bash
    git add .
    git commit -m "Add detailed README sections and diagrams"
    ```

5. **Push to Your Fork:**
    ```bash
    git push origin feature/YourFeatureName
    ```

6. **Open a Pull Request:**
    Navigate to your fork on GitHub and click "Compare & pull request".

### Development Guidelines

- **Follow Best Practices:**
  - Adhere to Rust and JavaScript coding standards.
  - Write clean, readable, and maintainable code.
  - Ensure consistent code formatting using tools like `rustfmt` and `eslint`.

- **Maintain Test Coverage:**
  - Write unit and integration tests for new features.
  - Ensure existing tests pass before submitting changes.

- **Document New Features:**
  - Update relevant sections in the README.md.
  - Add or update API documentation as needed.

- **Update API Documentation:**
  - Ensure all new endpoints and functionalities are well-documented.
  - Use tools like Swagger for API documentation if applicable.

### Testing

Ensure all tests pass before submitting a pull request.

```bash
# Run Rust tests
cargo test

# Run JavaScript tests
npm test

# Run End-to-End Tests
npm run test:e2e
```

- **Continuous Integration:**
  - Automated tests run on every pull request.
  - Ensure no breaking changes are introduced.

- **Code Reviews:**
  - All pull requests should be reviewed by at least one maintainer.
  - Address all review comments before merging.

### Issue Reporting

If you encounter any bugs or have feature requests, please open an issue in the repository with detailed information.

## Additional Resources

- **Documentation:**
  - Comprehensive documentation is available in the `docs/` directory.
  - API references and usage guides are provided.

- **Support:**
  - Join the project's Slack channel for real-time support.
  - Reach out via GitHub Issues for any assistance.

- **Updates:**
  - Follow the repository to stay updated with the latest changes and releases.

## Acknowledgements

- **Prof Rob Aspin:** For inspiring the project's vision and providing valuable resources.
- **OpenAI:** For their advanced AI models powering the question-answering features.
- **Perplexity AI and RAGFlow:** For their AI services enhancing content processing and interaction.
- **Three.js:** For the robust 3D rendering capabilities utilized in the frontend.
- **Actix:** For the high-performance web framework powering the backend server.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

